type Banana = Banana {quantity}
type Grape = Grape  {quantity}
type Orange = Orange {quantity}

trait Fruit
where

    subtotal : Fruit -> Int


extends Banana with Fruit
where
    subtotal item = 158 * (.quantity item)

extends Grape with Fruit

where
   subtotal item = 178 * (.quantity item)


extends Orange with Fruit where

    subtotal item = 98 * (.quantity item)


coupon item = reify Fruit
              where
                     subtotal _ = 0.75 * (subtotal item)

[Orange{10}, Banana{15}, coupon Grape{10}]  |> map subtotal |> sum